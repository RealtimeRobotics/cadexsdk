<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CAD Exchanger SDK: Computational meshers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link rel="icon" type="image/png" sizes="16x16" href="https://cloud.cadexchanger.com/assets/images/icon16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cloud.cadexchanger.com/assets/images/icon32.png">
<link rel="icon" type="image/png" sizes="96x96" href="https://cloud.cadexchanger.com/assets/images/icon96.png">
<link href="https://fonts.googleapis.com/css?family=Nunito:300" rel="stylesheet">
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="cadex_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<a id="logo" href="https://cadexchanger.com/products/sdk" style="height:48px">
  <img id="projectlogo" alt="Logo" src="logo-36.png"/>
  <span id="projectname" style="padding-left:0.5em;">CAD Exchanger SDK</span>
</a>
</div>
<div class="body-content">
<div class="collapsible">
  <a id="show-menu-button" href="#">Hide menu</a>
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sdk_meshing_advalgos.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Computational meshers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sdk_meshing_mefisto">Mefisto-based algorithm</a></li>
<li class="level1"><a href="#sdk_meshing_netgen">Netgen-based algorithm</a></li>
<li class="level1"><a href="#sdk_meshing_example">Examples</a></li>
<li class="level1"><a href="#sdk_meshing_adv_limit">Limitations</a></li>
<li class="level1"><a href="#sdk_meshing_adv_comp">Visual comparisons</a></li>
<li class="level1"><a href="#sdk_meshing_advalgos_netgen">Netgen-specific extensions</a><ul><li class="level2"><a href="#sdk_meshing_netgen_volume">Generation of volume (3D) meshes</a></li>
<li class="level2"><a href="#sdk_meshing_netgen_bc">Specifying boundary conditions</a></li>
<li class="level2"><a href="#sdk_meshing_netgen_export">Export to specific file formats</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>CAD Exchanger offers the following algorithms based on third-party meshers: </p><ul>
<li>Mefisto-based algorithm; </li>
<li>Netgen-based algorithm.</li>
</ul>
<h1><a class="anchor" id="sdk_meshing_mefisto"></a>
Mefisto-based algorithm</h1>
<p>Mefisto is provided by the <a class="el" href="classcadex_1_1_mesh_algo___mefisto_factory.html" title="Creates an instance of the Mefisto meshing algorithm. ">MeshAlgo_MefistoFactory</a> class.</p>
<p>When building a mesh, Mefisto uses a maximum element length parameter M. M is computed for each edge from the user-defined parameters (see <a class="el" href="structcadex_1_1_mesh_algo___mefisto_factory_1_1_parameters.html" title="Defines parameters used by the Mefisto meshing algorithm. ">MeshAlgo_MefistoFactory::Parameters</a> class) as a minimum of three values: </p><ul>
<li>Explicitly defined absolute value; </li>
<li>Value calculated from a ratio to the bounding box of a parent shape (Shell or Solid); </li>
<li>Value calculated from a ratio to the bounding box of a parent Face. If an edge is shared by two (or more) faces then the minimum of all faces is taken.</li>
</ul>
<p>First, Mefisto splits each model edge honoring individual edge max sizes. Then it builds triangular tessellation for each model face using max size computed from the bounding box of the face. Mefisto works in 2D parameter space using approximate scaling along U and V directions to produce regular mesh in 3D. It is usually faster than Netgen but may produce triangles which sometimes are more skewed than those produced by Netgen.</p>
<h1><a class="anchor" id="sdk_meshing_netgen"></a>
Netgen-based algorithm</h1>
<p>Netgen is provided by the <a class="el" href="classcadex_1_1_mesh_algo___netgen_factory.html" title="Creates a meshing algorithm based on the Netgen library. ">MeshAlgo_NetgenFactory</a> class.</p>
<p>Netgen uses multiple parameters, including maximum and minimum element sizes, mesh granularity, number of optimization steps, etc. See <a class="el" href="structcadex_1_1_mesh_algo___netgen_factory_1_1_parameters.html" title="Defines parameters used by the Netgen meshing algorithm. ">MeshAlgo_NetgenFactory::Parameters</a> for details.</p>
<p>Netgen primarily works in 3D. Depending on set parameters, it may produce elements with sizes adjusted to local curvatures - greater at flat surface patches and smaller at bending parts.</p>
<p>Once the mesh has been built for edges and faces, Netgen performs additional iterations (controlled by user-defined parameter <a class="el" href="structcadex_1_1_mesh_algo___netgen_factory_1_1_parameters.html#a556e33a763fae67d772454242b89a197" title="Number of steps in surface mesh optimization. ">MeshAlgo_NetgenFactory::Parameters::myOptSteps</a>) to optimize the mesh. Setting this parameter to 0 disables optimization.</p>
<p>Netgen is generally slower than Mefisto and is more sensitive to quality of the input models. It is especially vulnerable (working very slowly) to elongate pin-like faces (or parts thereof).</p>
<p>For surface tessellation Netgen uses the advancing front method.</p>
<h1><a class="anchor" id="sdk_meshing_example"></a>
Examples</h1>
<p>Refer to <a class="el" href="sdk_netgen_mesher_example_page.html">Netgen Mesher Example</a>, <a class="el" href="sdk_mefisto_mesher_example_page.html">Mefisto Mesher Example</a>.</p>
<h1><a class="anchor" id="sdk_meshing_adv_limit"></a>
Limitations</h1>
<p>In addition to above mentioned issues of performance and sensitivity to input geometry, both Netgen and Mefisto can produce too fine-grain meshes. This will result in significant memory footprint (up to hundreds of MB's). In many cases, on complex models, this may result in exceeding virtual memory available for 32 bit applications. Thus, users may have to tailor default parameters for their most typical model configurations.</p>
<p>To mitigate adverse impact of limitations (primarily performance and memory footprint) users can be recommended to consider the following strategies: </p><ul>
<li>To launch the mesher in a separate worker thread. This will allow to avoid blocking the application GUI thread and will therefore keep the application responsive. In ultimate case, that worker thread can be killed without complete loss of user's data. </li>
<li>To launch the mesher in a separate worker process. This will not only provide benefits of the previous approach but also can reduce memory footprints at interim computational steps as each process will start with clean memory. To communicate data back from worker processes some method should be designed. One approach is to use temporary STL files to save computed mesh model and restore it in main process.</li>
</ul>
<h1><a class="anchor" id="sdk_meshing_adv_comp"></a>
Visual comparisons</h1>
<p>The following images compare the same models triangulated with the two meshers:</p>
<table  border="0" align="center">
<tr>
<td align="center">Mesh built Mefisto </td><td align="center">Mesh built Netgen  </td></tr>
<tr>
<td><div class="image">
<img src="blend59-mesh-mefisto-256.png" alt="blend59-mesh-mefisto-256.png"/>
</div>
 </td><td><div class="image">
<img src="blend59-mesh-netgen-256.png" alt="blend59-mesh-netgen-256.png"/>
</div>
  </td></tr>
<tr>
<td><div class="image">
<img src="blend75-mesh-mefisto-256.png" alt="blend75-mesh-mefisto-256.png"/>
</div>
 </td><td><div class="image">
<img src="blend75-mesh-netgen-256.png" alt="blend75-mesh-netgen-256.png"/>
</div>
  </td></tr>
<tr>
<td><div class="image">
<img src="blend85-mesh-mefisto-256.png" alt="blend85-mesh-mefisto-256.png"/>
</div>
 </td><td><div class="image">
<img src="blend85-mesh-netgen-256.png" alt="blend85-mesh-netgen-256.png"/>
</div>
  </td></tr>
</table>
<h1><a class="anchor" id="sdk_meshing_advalgos_netgen"></a>
Netgen-specific extensions</h1>
<p>CAD Exchanger provides additional extensions when working with the Netgen-based algorithm provided by the <a class="el" href="classcadex_1_1_mesh_algo___netgen_factory.html" title="Creates a meshing algorithm based on the Netgen library. ">MeshAlgo_NetgenFactory</a> class. These include:</p>
<ul>
<li>Generation of volume (3D) meshes; </li>
<li>Specifying boundary conditions; </li>
<li>Export to specific file formats.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>These extensions may only be used for solid bodies (<a class="el" href="classcadex_1_1_model_data___solid.html" title="Defines a topological solid. ">ModelData_Solid</a> and respective <a class="el" href="classcadex_1_1_model_data___body.html" title="Defines a root topological shape that can be owned by B-Rep representation. ">ModelData_Body</a>).</dd></dl>
<h2><a class="anchor" id="sdk_meshing_netgen_volume"></a>
Generation of volume (3D) meshes</h2>
<p>In addition to 2D surface elements, Netgen may also create 3D tetrahedron elements. To enable that, respective parameters must be set prior to invoking a computational mesher as follows: </p><div class="fragment"><div class="line">ModelData_Shape aShape = ...;</div><div class="line"></div><div class="line">MeshAlgo_NetgenFactory aF;</div><div class="line">MeshAlgo_NetgenFactory::Parameters aP;</div><div class="line"></div><div class="line"><span class="comment">//enable volume meshing</span></div><div class="line">aP.myIsVolumeMesh   = <span class="keyword">true</span>;</div><div class="line">aP.myVolumeOptSteps = 3;</div><div class="line"></div><div class="line">aF.SetParameters (aP);</div><div class="line"></div><div class="line"><span class="comment">//set computational mesher</span></div><div class="line">ModelAlgo_BRepMesher aMesher;</div><div class="line">ModelAlgo_BRepMesherParameters&amp; aParam = aMesher.Parameters();</div><div class="line">aParam.ComputationalMeshAlgo() = aF;</div><div class="line"></div><div class="line"><span class="comment">//iterate over bodies</span></div><div class="line">ModelData_BRepRepresentation aBRep (aShape);</div><div class="line"><span class="keyword">const</span> ModelData_BodyList&amp; aList = aBRep.Get();</div><div class="line"><span class="keywordflow">for</span> (ModelData_BodyList::SizeType i = 0; i &lt; aList.Size(); ++i) {</div><div class="line">    <span class="keyword">const</span> ModelData_Body&amp; aBody = aList[i];</div><div class="line">    std::shared_ptr&lt;Mesh_SMDS&gt; aMeshDS;</div><div class="line">    ModelData_PolyShapeList aPSL = aMesher.Compute (aBody, aMeshDS);</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p>After initial generation of volume elements, Netgen may invoke iterative optimization. The number of these iterations can be controlled by the <a class="el" href="structcadex_1_1_mesh_algo___netgen_factory_1_1_parameters.html#a5b177c23a72dba07b24126d811945062" title="Number of steps in volume mesh optimization. ">MeshAlgo_NetgenFactory::Parameters::myVolumeOptSteps</a> parameter.</p>
<p>Once the computational mesh has been created, the internal Netgen mesh can be retrieved and queried as follows: </p><div class="fragment"><div class="line"><span class="keywordflow">if</span> (aMeshDS &amp;&amp; aMeshDS-&gt;HasNetgenMeshDS()) {</div><div class="line">    <span class="keyword">const</span> Mesh_NetgenMeshDS&amp; aNetgenMeshDS = aMeshDS-&gt;NetgenMeshDS();</div><div class="line"></div><div class="line">    <span class="keywordtype">size_t</span> n = aNetgenMeshDS.NumberOfVolumeElements();</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="sdk_meshing_netgen_bc"></a>
Specifying boundary conditions</h2>
<p>To prepare the mesh for further usage in CAE applications, original B-Rep faces may be assigned with boundary conditions.</p>
<p>SDK API refers to a boundary condition via its integer id and allows to specify a string name for each boundary condition.</p>
<p>The following example demonstrates how to assign boundary conditions: </p><div class="fragment"><div class="line">ModelData_Body aBody = ...; <span class="comment">//original BRep body</span></div><div class="line"><span class="keyword">const</span> Mesh_NetgenMeshDS&amp; aNetgenMeshDS = aMeshDS.NetgenMeshDS();</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (ModelData_Shape::Iterator i; i.HasNext();) {</div><div class="line">    <span class="keyword">const</span> ModelData_Face&amp; aFace = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span>ModelData_Face&amp; aFace<span class="keyword">&gt;</span> (i.Next());</div><div class="line">    <span class="keywordtype">int</span> aBCIndex = ...; <span class="comment">//retrieve the boundary condition id for the face</span></div><div class="line">    aNetgenMeshDS.SetFaceBCIndex (aFace, aBCIndex);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; aNumberOfBC; ++i) {</div><div class="line">    Base_String aBCName = ...; <span class="comment">//name of the i-th boundary condition</span></div><div class="line">    aNetgenMeshDS.SetBCName (aBCIndex, aBCName;</div><div class="line">}</div></div><!-- fragment --><p>Boundary condition indices must be greater or equal to 1. Although CAD Exchanger SDK does not enforce the requirement that indices must be sequential, the internal Netgen algorithms may have such expectations and behave indefinitely otherwise. So ensuring that there are no gaps in the indices is strongly recommended.</p>
<h2><a class="anchor" id="sdk_meshing_netgen_export"></a>
Export to specific file formats</h2>
<p>CAD Exchanger SDK allows to export internal Netgen meshes to the following file formats: </p><ul>
<li>Netgen native neutral .vol format (<a class="el" href="classcadex_1_1_mesh___netgen_neutral_writer.html" title="Writes Netgen mesh to Neutral format. ">Mesh_NetgenNeutralWriter</a>); </li>
<li>Abaqus format (using <a class="el" href="classcadex_1_1_mesh___netgen_abaqus_writer.html" title="Writes Netgen mesh to Abaqus format. ">Mesh_NetgenAbaqusWriter</a>); </li>
<li>Fluent format (using <a class="el" href="classcadex_1_1_mesh___netgen_fluent_writer.html" title="Writes Netgen mesh to Fluent format. ">Mesh_NetgenFluentWriter</a>); </li>
<li>OpenFOAM format (using <a class="el" href="classcadex_1_1_mesh___netgen_open_f_o_a_m_writer.html" title="Writes Netgen mesh to OpenFOAM format. ">Mesh_NetgenOpenFOAMWriter</a>).</li>
</ul>
<p>CAD Exchanger relies on own Netgen implementation of export. All the writers inherit common base class (<a class="el" href="classcadex_1_1_mesh___netgen_base_writer.html" title="Base class for Netgen mesh writers. ">Mesh_NetgenBaseWriter</a>) and follow consistent approach: </p><div class="fragment"><div class="line"><span class="keyword">const</span> Mesh_NetgenMeshDS&amp; aNetgenMeshDS = aMeshDS.NetgenMeshDS();</div><div class="line"></div><div class="line">Mesh_NetgenNeutralWriter aWriter;</div><div class="line"><span class="keywordflow">if</span> (!aWriter.WriteFile (aNetgenMeshDS, <span class="stringliteral">&quot;myfile.vol&quot;</span>)) {</div><div class="line">    std::cerr &lt;&lt; <span class="stringliteral">&quot;Error occured during writing a mesh file&quot;</span> &lt;&lt; std::endl;</div><div class="line">}</div></div><!-- fragment --><p>The OpenFOAM exporter additionally allows to customize the mechanism of writing boundary conditions. Refer to <a class="el" href="classcadex_1_1_mesh___netgen_open_f_o_a_m_writer.html" title="Writes Netgen mesh to OpenFOAM format. ">Mesh_NetgenOpenFOAMWriter</a> for details. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
</div>
<div id="nav-path" class="navpath">
  <ul>
    <li class="footer">
      <a href="https://cadexchanger.com/custom-development" style="background: #226daa; color:#fff; padding: 6px; text-decoration: none; border-radius: 5px;">Custom Development</a>
      <a href="https://cadexchanger.com/products/gui" style="margin:5px;">GUI</a>
      <a href="https://cadexchanger.com/products/sdk" style="margin:5px;">SDK</a>
      <a href="https://cadexchanger.com/products/cli" style="margin:5px;">CLI</a>
      <a href="https://cadexchanger.com/products/web-toolkit" style="margin:5px;">Web Toolkit</a>
      <a href="https://cadexchanger.com/products/cloud" style="margin:5px;">Cloud</a>
      <a href="https://cadexchanger.com/products/cloud-api" style="margin:5px;">Cloud API</a>
      <a href="https://cadexchanger.com/iges" style="margin:5px; color: #838383;">IGES</a>
      <a href="https://cadexchanger.com/step" style="margin:5px; color: #838383;">STEP</a>
      <a href="https://cadexchanger.com/parasolid" style="margin:5px; color: #838383;">Parasolid</a>
      <a href="https://cadexchanger.com/acis" style="margin:5px; color: #838383;">ACIS</a>
      <a href="https://cadexchanger.com/jt" style="margin:5px; color: #838383;">JT</a>
      <a href="https://cadexchanger.com/stl" style="margin:5px; color: #838383;">STL</a>
      <a href="https://cadexchanger.com/obj" style="margin:5px; color: #838383;">OBJ</a>
      <a href="https://cadexchanger.com/solidworks" style="margin:5px; color: #838383;">SolidWorks</a>
      <a href="https://cadexchanger.com/creo" style="margin:5px; color: #838383;">Creo</a>
      <a href="https://cadexchanger.com/nx" style="margin:5px; color: #838383;">NX</a>
      <a href="https://cadexchanger.com/catia" style="margin:5px; color: #838383;">CATIA</a>
      <a href="https://cadexchanger.com/ifc" style="margin:5px; color: #838383;">IFC</a>
      <a href="https://cadexchanger.com/rhino" style="margin:5px; color: #838383;">Rhino</a>
      <a href="https://cadexchanger.com/vrml" style="margin:5px; color: #838383;">VRML</a>
      <a href="https://cadexchanger.com/fbx" style="margin:5px; color: #838383;">FBX</a>
      <a href="https://cadexchanger.com/gltf" style="margin:5px; color: #838383;">GLTF</a>
      <a href="https://cadexchanger.com/dxf" style="margin:5px; color: #838383;">DXF</a>
      <a href="https://cadexchanger.com/dwg" style="margin:5px; color: #838383;">DWG</a>
      <a href="https://cadexchanger.com/collada" style="margin:5px; color: #838383;">Collada</a>
      <a href="https://cadexchanger.com/3ds" style="margin:5px; color: #838383;">3DS</a>
      <a href="https://cadexchanger.com/x3d" style="margin:5px; color: #838383;">X3D</a>
      <a href="https://cadexchanger.com/3mf" style="margin:5px; color: #838383;">3MF</a>
      <a href="https://cadexchanger.com/u3d" style="margin:5px; color: #838383;">U3D</a>
      <a href="https://cadexchanger.com/3dpdf" style="margin:5px; color: #838383;">3D PDF</a>
      <a href="https://cadexchanger.com/prc" style="margin:5px; color: #838383;">PRC</a>
      <a href="https://cadexchanger.com/brep" style="margin:5px; color: #838383;">BRep</a>
      <a href="https://cadexchanger.com/usd" style="margin:5px; color: #838383;">USD</a>
      <a href="https://cadexchanger.com/" style="margin:5px; color: #838383;">cadexchanger.com</a>
    </li>
  </ul>
</div>
</body>
</html>
