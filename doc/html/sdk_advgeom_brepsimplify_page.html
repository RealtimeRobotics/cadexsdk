<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CAD Exchanger SDK: B-Rep Simplification</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link rel="icon" type="image/png" sizes="16x16" href="https://cloud.cadexchanger.com/assets/images/icon16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cloud.cadexchanger.com/assets/images/icon32.png">
<link rel="icon" type="image/png" sizes="96x96" href="https://cloud.cadexchanger.com/assets/images/icon96.png">
<link href="https://fonts.googleapis.com/css?family=Nunito:300" rel="stylesheet">
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="cadex_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<a id="logo" href="https://cadexchanger.com/products/sdk" style="height:48px">
  <img id="projectlogo" alt="Logo" src="logo-36.png"/>
  <span id="projectname" style="padding-left:0.5em;">CAD Exchanger SDK</span>
</a>
</div>
<div class="body-content">
<div class="collapsible">
  <a id="show-menu-button" href="#">Hide menu</a>
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sdk_advgeom_brepsimplify_page.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">B-Rep Simplification </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sdk_advgeom_brepsimplify_overview">Overview</a></li>
<li class="level1"><a href="#sdk_advgeom_brepsimplify_capabilities">Capabilities</a></li>
<li class="level1"><a href="#sdk_advgeom_brepsimplify_api">API overview</a></li>
<li class="level1"><a href="#sdk_advgeom_brepsimplify_tools">Simplification tools</a><ul><li class="level2"><a href="#sdk_advgeom_brepsimplify_tools_holeremover">Hole remover</a></li>
<li class="level2"><a href="#sdk_advgeom_brepsimplify_tools_ifr">Internal faces remover</a></li>
<li class="level2"><a href="#sdk_advgeom_brepsimplify_tools_sbr">Small bodies remover</a></li>
<li class="level2"><a href="#sdk_advgeom_brepsimplify_tools_meshsimpl">Mesh simplifier</a></li>
</ul>
</li>
<li class="level1"><a href="#sdk_advgeom_brepsimplify_limitations">Limitations</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="sdk_advgeom_brepsimplify_overview"></a>
Overview</h1>
<p>B-Rep simplification is a feature of Advanced Geometry Processing add-on that transforms B-Rep and mixed (B-Rep and polygonal) models so that their general visual appearance is maintained but geometry is simplified, i.e. contains fewer faces and triangles.</p>
<p>The component is implemented as a collection of simplification algorithms working on different features that can be composed in a pipeline for convenient application to models.</p>
<h1><a class="anchor" id="sdk_advgeom_brepsimplify_capabilities"></a>
Capabilities</h1>
<p>The features affected by simplification include: </p><ul>
<li>blind and through holes; </li>
<li>internal (invisible from most angles) faces and bodies; </li>
<li>small bodies; </li>
<li>meshes (decimated with <a class="el" href="classcadex_1_1_model_simplifier___mesh_simplifier.html" title="Generates a new model with simplified mesh. ">ModelSimplifier_MeshSimplifier</a>; see also <a class="el" href="sdk_advgeom_meshsimplify_page.html">Mesh Simplification</a>).</li>
</ul>
<p>These algorithms act as functions mapping one <a class="el" href="classcadex_1_1_model_data___model.html" title="Provides CAD Exchanger data model. ">ModelData_Model</a> instance to another, skipping or modifying certain faces, bodies and parts to get the final result. The original model is not modified in this process:</p>
<table  border="0" align="center">
<tr>
<td><div class="image">
<img src="advgeom_brepsimpltool.png" alt="advgeom_brepsimpltool.png"/>
</div>
  </td></tr>
<tr>
<td align="center">The effect of simplification tool that removes elements on the model structure.  </td></tr>
</table>
<h1><a class="anchor" id="sdk_advgeom_brepsimplify_api"></a>
API overview</h1>
<p><a class="el" href="classcadex_1_1_model_simplifier___simplifier.html" title="Provides an interface to the pipeline of B-Rep simplification tools. ">ModelSimplifier_Simplifier</a> class is the main way to perform B-Rep simplification. Its <a class="el" href="classcadex_1_1_model_simplifier___simplifier.html#a1e930a9f7bf1b9e9a321e34763fb716b">Peform</a> method accepts an instance of <a class="el" href="classcadex_1_1_model_data___model.html" title="Provides CAD Exchanger data model. ">ModelData_Model</a>, runs the algorithms on it and returns a different <a class="el" href="classcadex_1_1_model_data___model.html" title="Provides CAD Exchanger data model. ">ModelData_Model</a> instance. The instance of <a class="el" href="classcadex_1_1_model_simplifier___simplifier.html" title="Provides an interface to the pipeline of B-Rep simplification tools. ">ModelSimplifier_Simplifier</a> acts as a container for simplification algorithms, running them one after another in the specified order.</p>
<p>Concrete simplification algorithms are represented by the classes derived from <a class="el" href="classcadex_1_1_model_simplifier___simplifier_tool.html" title="Describes an interface that B-Rep simplification tools should implement. ">ModelSimplifier_SimplifierTool</a>. Each of them targets one of the features listed in the previous section. By convention, these classes all have <code>Tool</code> suffix in the class name.</p>
<p>There are 2 ways to use the API: </p><ul>
<li>Create a pipeline of tools automatically via <a class="el" href="classcadex_1_1_model_simplifier___simplifier_builder.html" title="Creates ModelSimplifier_Simplifier instance with pre-configured tools. ">ModelSimplifier_SimplifierBuilder</a>. The builder accepts 2 high-level parameters - <a class="el" href="classcadex_1_1_model_simplifier___simplifier_builder.html#a09fe1bb633a14696dee791b3ce54c4e6">SimplificationLevel</a> and <a class="el" href="classcadex_1_1_model_simplifier___simplifier_builder.html#ab398dabc5e6ad8b0d20e31b68977c98e">SimplifiedFeatureSize</a> and populates the simplifier with all the tools arranging them in the optimal order and tuning their parameters. </li>
<li>Create the required tools and tune their parameters manually. Then add them to the pipeline in the required order using <a class="el" href="classcadex_1_1_model_simplifier___simplifier.html#aafd24ea7cd54d14bd4270494a72b931e" title="Adds a tool to the simplification pipeline. ">ModelSimplifier_Simplifier::AddTool</a> method. This approach makes sense if you only need some tools or if the tool order and/or parameters created by <a class="el" href="classcadex_1_1_model_simplifier___simplifier_builder.html" title="Creates ModelSimplifier_Simplifier instance with pre-configured tools. ">ModelSimplifier_SimplifierBuilder</a> don't suit your use case.</li>
</ul>
<p>Below is an example of how <a class="el" href="classcadex_1_1_model_simplifier___simplifier.html" title="Provides an interface to the pipeline of B-Rep simplification tools. ">ModelSimplifier_Simplifier</a> might be used via the first approach:</p>
<div class="fragment"><div class="line">ModelData_Model aModel = <span class="comment">/* fill model */</span>;</div><div class="line">ModelSimplifier_SimplifierBuilder aBuilder;</div><div class="line">aBuilder.SetLevel (<a class="code" href="classcadex_1_1_model_simplifier___simplifier_builder.html#a09fe1bb633a14696dee791b3ce54c4e6afd71f31483815b00b477db64445a2e70">ModelSimplifier_SimplifierBuilder::Low</a>);</div><div class="line">aBuilder.SetFeatureSize (<a class="code" href="classcadex_1_1_model_simplifier___simplifier_builder.html#ab398dabc5e6ad8b0d20e31b68977c98ea84da1f5c5298a011d73462f109a87ede">ModelSimplifier_SimplifierBuilder::Large</a>);</div><div class="line">ModelSimplifier_Simplifier aSimplifier = aBuilder.CreatePipeline();</div><div class="line">ModelData_Model aSimplifiedModel = aSimplifier.Perform (aModel);</div></div><!-- fragment --><p>B-Rep simplification component also provides an ability to apply the algorithms conditionally through the <a class="el" href="classcadex_1_1_model_simplifier___shape_predicate.html">ModelSimplifier_ShapePredicate</a> interface. To use it one should create a derived class and implement 2 predicates accepting <a class="el" href="classcadex_1_1_model_data___shape.html" title="Base class of topological shapes. ">ModelData_Shape</a> and returning a boolean value. One predicate determines whether the simplification will be applied to the shape at all. Another determines whether simplification is allowed to break the shape up into pieces. Shapes passed to this predicate are normally <a class="el" href="classcadex_1_1_model_data___body.html">bodies</a>, and the predicate can in principle use any reasonable parameter of these shapes to make a decision, including outside information, such as user-defined parameters of the shape. Once created the predicate can be passed to the <a class="el" href="classcadex_1_1_model_simplifier___simplifier_builder.html" title="Creates ModelSimplifier_Simplifier instance with pre-configured tools. ">ModelSimplifier_SimplifierBuilder</a> or to individual tools if the pipeline is assembled manually.</p>
<p>Below is an example of how the shape predicate might use user-defined properties to forbid B-Rep simplifier to work on specific shapes:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ImportantBodySkipper : <span class="keyword">public</span> ModelSimplifier_ShapePredicate</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ImportantBodySkipper (<span class="keyword">const</span> ModelData_BRepRepresentation&amp; theParentRep) : myParentRep (theParentRep)</div><div class="line">    {}</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> CanSimplifyShape (<span class="keyword">const</span> ModelData_Shape&amp; theShape)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        ModelData_PropertyTable aProps = myParentRep.PropertyTable (theShape);</div><div class="line">        <span class="keywordflow">if</span> (aProps.IsNull()) {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        Base_UTF16String aCategory;</div><div class="line">        <span class="keywordflow">if</span> (!aProps.FindProperty (<span class="stringliteral">&quot;category&quot;</span>, aCategory)) {</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> aCategory != <span class="stringliteral">&quot;important&quot;</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> CanSplitShape (<span class="keyword">const</span> ModelData_Shape&amp; theShape)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// forbid shape splitting altogether</span></div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    ModelData_BRepRepresentation myParentRep;</div><div class="line">};</div></div><!-- fragment --><h1><a class="anchor" id="sdk_advgeom_brepsimplify_tools"></a>
Simplification tools</h1>
<p>In this section we'll briefly cover the simplification tools and their parameters</p>
<h2><a class="anchor" id="sdk_advgeom_brepsimplify_tools_holeremover"></a>
Hole remover</h2>
<p>Simplification tool that removes blind and through holes. It searches and identifies geometric configurations that represent such holes and then attempts to remove them from the model.</p>
<table  border="0" align="center">
<tr>
<td><div class="image">
<img src="advgeom_holeremover.png" alt="advgeom_holeremover.png"/>
</div>
  </td></tr>
<tr>
<td><b>Left:</b> section of solid model with multiple through holes. <b>Right:</b> section of said model passed through Hole remover.  </td></tr>
</table>
<p>The <a class="el" href="classcadex_1_1_model_simplifier___hole_remover_tool.html#aa937f2c07e55ab7a61f666f005fecff5">ExtentThreshold</a>, <a class="el" href="classcadex_1_1_model_simplifier___hole_remover_tool.html#a8b18b1d24252be2a667ae98ab1852b99">VolumeThreshold</a> and <a class="el" href="classcadex_1_1_model_simplifier___hole_remover_tool.html#acb2b8fda9e3f3ec71f699a649f5fd2a2">DiagonalThreshold</a> define the different thresholds used to judge whether the geometry detected as internal part of the hole is truly that. The algorithm that produces candidates for hole internals also finds the faces of boss-like features, so these thresholds are used to classify the candidates into holes and bosses and thus only process real holes. Another parameter - <a class="el" href="classcadex_1_1_model_simplifier___hole_remover_tool.html#afaff381ddf655b0a6a1a60ecec54d026">PerformInterferenceCheck</a>, specifies whether the faces in the resulting model, that occupy the place where the hole entrances originally were, should be checked for intersections with the rest of the model. Disabling this setting may lead to questionable-looking model, but yields better simplification ratio.</p>
<h2><a class="anchor" id="sdk_advgeom_brepsimplify_tools_ifr"></a>
Internal faces remover</h2>
<p>Simplification tool that removes the portions of the model not visible from most angles from outside. It checks faces from multiple viewing angles and viewpoints and if they can't be seen from anywhere, deletes them. Face-oriented approach allows to simplify the model the most, however, the model quality deteriorates - solid bodies turn into unclosed sheet bodies. Hence, the tool can also be configured to only delete whole bodies.</p>
<table  border="0" align="center">
<tr>
<td><div class="image">
<img src="advgeom_internalfacesremover.png" alt="advgeom_internalfacesremover.png"/>
</div>
  </td></tr>
<tr>
<td><b>Left:</b> section of solid assembly with lots of internal details. <b>Right:</b> section of said assembly passed through Internal faces remover.  </td></tr>
</table>
<p>The visibility checks in the tool are parameterized by <a class="el" href="classcadex_1_1_model_simplifier___internal_faces_remover_tool.html#a2f596f53112ba5b008beeb5dcc10e84b">linear tolerance</a> and <a class="el" href="classcadex_1_1_model_simplifier___internal_faces_remover_tool.html#ac917ad99a70ac495d7d0e47b91c9dc64">angular tolerance</a>. The larger these tolerances are, the larger the holes (through which internal details are visible) are ignored when considering the visibility of internal faces. By default the linear tolerance is relative to the size of the model's bounding box. When <a class="el" href="classcadex_1_1_model_simplifier___internal_faces_remover_tool.html#a4cfacef8168c58315701de543f4cd63d">IsLinearToleranceRelative</a> is set to false, linear tolerance value is interpreted as absolute value in millimeters.</p>
<p>The <a class="el" href="classcadex_1_1_model_simplifier___internal_faces_remover_tool.html#a3ca34e4b936c1a08af3b63029ab90598">PreserveSharing</a> parameter specifies what to do in a situation where a face in a part instanced in 2 locations in the model is visible in one location but not the other. When the parameter is enabled, only those faces not visible in every instance of their part are deleted. When it's disabled, all faces are deleted, but owning part sharing is broken (i.e. another part is created and leftover geometry is duplicated).</p>
<h2><a class="anchor" id="sdk_advgeom_brepsimplify_tools_sbr"></a>
Small bodies remover</h2>
<p>Simplification tool that removes bodies that are small compared to the entirety of the model. It measures sizes of bodies and removes those that don't exceed the treshold. Alternatively, it can operate in a bit more sophisticated mode that also considers the role of the body within the model. If the body is deemed to play a significant role in the model, it is not removed even when going under the threshold.</p>
<p>The mode of operation is controlled by <a class="el" href="classcadex_1_1_model_simplifier___small_bodies_remover_tool.html#a5494d7d46313390ff7b3252c281d7b58">RemovalIsVisualQualityAware</a> parameter. It is on by default to prevent changes that would severely compromise the appearance of the model. The severity of visual appearance change is judged according to the <a class="el" href="classcadex_1_1_model_simplifier___small_bodies_remover_tool.html#a74aa1bbe110a04de898794f821cc7589">VisualQualityThreshold</a> parameter. The original candidates for removal are selected according to the <a class="el" href="classcadex_1_1_model_simplifier___small_bodies_remover_tool.html#a4e8e16b5029ba02b6c968795cc587bae">Threshold</a> parameter.</p>
<h2><a class="anchor" id="sdk_advgeom_brepsimplify_tools_meshsimpl"></a>
Mesh simplifier</h2>
<p><a class="el" href="classcadex_1_1_model_simplifier___mesh_simplifier_tool.html">ModelSimplifier_MeshSimplifierTool</a> is just an adaptation of <a class="el" href="classcadex_1_1_model_simplifier___mesh_simplifier.html" title="Generates a new model with simplified mesh. ">ModelSimplifier_MeshSimplifier</a> to the <a class="el" href="classcadex_1_1_model_simplifier___simplifier_tool.html" title="Describes an interface that B-Rep simplification tools should implement. ">ModelSimplifier_SimplifierTool</a> interface. <a class="el" href="sdk_advgeom_meshsimplify_page.html">See here</a> for detailed description of mesh simplification.</p>
<h1><a class="anchor" id="sdk_advgeom_brepsimplify_limitations"></a>
Limitations</h1>
<p>Internal faces remover and small bodies remover are general enough to be working without significant mistakes on the majority of the models. Hole remover though currently only works with holes whose entrances are bounded by inner wires (i.e. holes whose entrances are incident to more than 1 face are not supported).</p>
<p>When configuring the tools manually certain parameter configurations may lead to huge computational effort required to execute the algorithm so that it appears to hang. In such cases the parameters may need to be relaxed to allow the algorithms to finish in reasonable time. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
</div>
<div id="nav-path" class="navpath">
  <ul>
    <li class="footer">
      <a href="https://cadexchanger.com/custom-development" style="background: #226daa; color:#fff; padding: 6px; text-decoration: none; border-radius: 5px;">Custom Development</a>
      <a href="https://cadexchanger.com/products/gui" style="margin:5px;">GUI</a>
      <a href="https://cadexchanger.com/products/sdk" style="margin:5px;">SDK</a>
      <a href="https://cadexchanger.com/products/cli" style="margin:5px;">CLI</a>
      <a href="https://cadexchanger.com/products/web-toolkit" style="margin:5px;">Web Toolkit</a>
      <a href="https://cadexchanger.com/products/cloud" style="margin:5px;">Cloud</a>
      <a href="https://cadexchanger.com/products/cloud-api" style="margin:5px;">Cloud API</a>
      <a href="https://cadexchanger.com/iges" style="margin:5px; color: #838383;">IGES</a>
      <a href="https://cadexchanger.com/step" style="margin:5px; color: #838383;">STEP</a>
      <a href="https://cadexchanger.com/parasolid" style="margin:5px; color: #838383;">Parasolid</a>
      <a href="https://cadexchanger.com/acis" style="margin:5px; color: #838383;">ACIS</a>
      <a href="https://cadexchanger.com/jt" style="margin:5px; color: #838383;">JT</a>
      <a href="https://cadexchanger.com/stl" style="margin:5px; color: #838383;">STL</a>
      <a href="https://cadexchanger.com/obj" style="margin:5px; color: #838383;">OBJ</a>
      <a href="https://cadexchanger.com/solidworks" style="margin:5px; color: #838383;">SolidWorks</a>
      <a href="https://cadexchanger.com/creo" style="margin:5px; color: #838383;">Creo</a>
      <a href="https://cadexchanger.com/nx" style="margin:5px; color: #838383;">NX</a>
      <a href="https://cadexchanger.com/catia" style="margin:5px; color: #838383;">CATIA</a>
      <a href="https://cadexchanger.com/ifc" style="margin:5px; color: #838383;">IFC</a>
      <a href="https://cadexchanger.com/rhino" style="margin:5px; color: #838383;">Rhino</a>
      <a href="https://cadexchanger.com/vrml" style="margin:5px; color: #838383;">VRML</a>
      <a href="https://cadexchanger.com/fbx" style="margin:5px; color: #838383;">FBX</a>
      <a href="https://cadexchanger.com/gltf" style="margin:5px; color: #838383;">GLTF</a>
      <a href="https://cadexchanger.com/dxf" style="margin:5px; color: #838383;">DXF</a>
      <a href="https://cadexchanger.com/dwg" style="margin:5px; color: #838383;">DWG</a>
      <a href="https://cadexchanger.com/collada" style="margin:5px; color: #838383;">Collada</a>
      <a href="https://cadexchanger.com/3ds" style="margin:5px; color: #838383;">3DS</a>
      <a href="https://cadexchanger.com/x3d" style="margin:5px; color: #838383;">X3D</a>
      <a href="https://cadexchanger.com/3mf" style="margin:5px; color: #838383;">3MF</a>
      <a href="https://cadexchanger.com/u3d" style="margin:5px; color: #838383;">U3D</a>
      <a href="https://cadexchanger.com/3dpdf" style="margin:5px; color: #838383;">3D PDF</a>
      <a href="https://cadexchanger.com/prc" style="margin:5px; color: #838383;">PRC</a>
      <a href="https://cadexchanger.com/brep" style="margin:5px; color: #838383;">BRep</a>
      <a href="https://cadexchanger.com/usd" style="margin:5px; color: #838383;">USD</a>
      <a href="https://cadexchanger.com/" style="margin:5px; color: #838383;">cadexchanger.com</a>
    </li>
  </ul>
</div>
</body>
</html>
