<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CAD Exchanger SDK: Progress Status Support</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link rel="icon" type="image/png" sizes="16x16" href="https://cloud.cadexchanger.com/assets/images/icon16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cloud.cadexchanger.com/assets/images/icon32.png">
<link rel="icon" type="image/png" sizes="96x96" href="https://cloud.cadexchanger.com/assets/images/icon96.png">
<link href="https://fonts.googleapis.com/css?family=Nunito:300" rel="stylesheet">
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="cadex_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<a id="logo" href="https://cadexchanger.com/products/sdk" style="height:48px">
  <img id="projectlogo" alt="Logo" src="logo-36.png"/>
  <span id="projectname" style="padding-left:0.5em;">CAD Exchanger SDK</span>
</a>
</div>
<div class="body-content">
<div class="collapsible">
  <a id="show-menu-button" href="#">Hide menu</a>
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sdk_progress_page.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Progress Status Support </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sdk_progress_overview">Overview</a></li>
<li class="level1"><a href="#sdk_progress_status_object">The progress status object</a></li>
<li class="level1"><a href="#sdk_progress_observers">User-defined observers</a></li>
<li class="level1"><a href="#sdk_progress_scopes">Scopes</a></li>
<li class="level1"><a href="#sdk_progress_chain">Algorithms chain</a></li>
<li class="level1"><a href="#sdk_progress_user_algorithms">Using progress status in user-defined algorithms</a></li>
<li class="level1"><a href="#sdk_progress_user_multithreading">Multi-threading considerations</a></li>
<li class="level1"><a href="#sdk_progress_cancelation">Cancellation support</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="sdk_progress_overview"></a>
Overview</h1>
<p>Several CAD Exchanger algorithms that can take significant time for execution support progress status update. This is achieved via <a class="el" href="classcadex_1_1_base___progress_status.html" title="Provides progress status and notification mechanism. ">Base_ProgressStatus</a> which instance can be updated by the algorithm. During its execution the algorithm increments progress status via a hierarchy of nested scopes (<a class="el" href="classcadex_1_1_base___progress_scope.html" title="Represents a node in a hierarchy of progress scopes. ">Base_ProgressScope</a>).</p>
<p><a class="el" href="classcadex_1_1_base___progress_status.html" title="Provides progress status and notification mechanism. ">Base_ProgressStatus</a> also supports cancelation of the operation.</p>
<p>To enable forwarding notifications of the progress status update to the user-defined entities, <a class="el" href="classcadex_1_1_base___progress_status.html" title="Provides progress status and notification mechanism. ">Base_ProgressStatus</a> implements an observer pattern with the help of a class <a class="el" href="classcadex_1_1_base___progress_status_1_1_observer.html" title="Base abstract class for observers registered in Base_ProgressStatus. ">Base_ProgressStatus::Observer</a>. The subclasses implement particular actions to reflect the status update, e.g. updating a graphical progress indicator, printing a new value of the progress status into console window, etc.</p>
<p>The following code snippet demonstrates subscription to the progress status notifications and update of the graphical progress bar. For a complete example that uses Qt graphical framework refer to the <a class="el" href="sdk_progress_bar_qt_example_page.html">Progress Bar with Qt Example</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>ProgressBarObserver : <span class="keyword">public</span> Base_ProgressStatus::Observer</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    ProgressBarObserver (QProgressBar* theProgressBar) : myProgressBar (theProgressBar) {}</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> ChangedValue (<span class="keyword">const</span> Base_ProgressStatus&amp; theInfo)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        myProgressBar-&gt;setValue (theInfo.Value());</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Completed (<span class="keyword">const</span> Base_ProgressStatus&amp; theInfo)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        myProgressBar-&gt;setValue (theInfo.Value());</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    QProgressBar*   myProgressBar;</div><div class="line">};</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">ProgressBarObserver anObserver (theProgressBar);</div><div class="line">{</div><div class="line">    Base_ProgressStatus aStatus;</div><div class="line">    aStatus.Register (anObserver);</div><div class="line"></div><div class="line">    ACIS_Reader aReader;</div><div class="line">    aReader.<a class="code" href="classcadex_1_1_base___reader.html#a71cd9a222d93c57573a52473523ee5fe">ProgressStatus</a>() = aStatus;</div><div class="line"></div><div class="line">    Base_ProgressScope aTopScope (aStatus);</div><div class="line">    {</div><div class="line">        Base_ProgressScope aScope (aStatus, 25);</div><div class="line">        anIsOK = aReader.ReadFile (theFileName.c_str());</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (anIsOK) {</div><div class="line">        Base_ProgressScope aScope (aStatus, 75);</div><div class="line">        anIsOK = aReader.Transfer (aModel);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="sdk_progress_status_object"></a>
The progress status object</h1>
<p>The <a class="el" href="classcadex_1_1_base___progress_status.html" title="Provides progress status and notification mechanism. ">Base_ProgressStatus</a> object represents a range [0, 100]. Upon creation, the current value of the status object is 0. It gets incremented during the algorithm execution. The frequency and uniformity of updates depends on the algorithm and its workload. For example when importing a file with numerous entities, the importer will trigger updates very often. However a file with a couple of curves only will be able to trigger very few updates.</p>
<p>The current value is returned by <a class="el" href="classcadex_1_1_base___progress_status.html#aaf6ec34ce826bb66b139322d4b6cba2c" title="Returns a current value. ">Base_ProgressStatus::Value()</a>. The type of the returned value is <em>float</em> what allows to monitor more fine-grained progress. Depending on the structure of an algorithm (nested scopes, number of updates, etc) the returned value may accumulate rounding errors. If you plan to convert a returned value to integer types (e.g. when using GUI progress bar widget accepting integer range) you might want to apply rounding, for example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> aValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span> (floor (aStatus.Value() + 0.5f));</div></div><!-- fragment --><p>This will allow to minimize impact of the internal rounding errors and display a value 79.9995 as 80% not as 79%.</p>
<h1><a class="anchor" id="sdk_progress_observers"></a>
User-defined observers</h1>
<p>To receive notifications on the progress status updates, define a subclass of <a class="el" href="classcadex_1_1_base___progress_status_1_1_observer.html" title="Base abstract class for observers registered in Base_ProgressStatus. ">Base_ProgressStatus::Observer</a> and redefine its virtual methods ChangedValue() and Completed(). The instance of the subclass must be registered in the progress status object with <a class="el" href="classcadex_1_1_base___progress_status.html#a9d535bfa8277bd74f0f4e103e7352d90" title="Adds an observer that will be notified when the progress status has changed. ">Base_ProgressStatus::Register()</a>.</p>
<p>The life span of an observer must be greater than the status object it is registered in. If the observer's life span needs to be shorter then Unregister() must be called to explicitly remove the observer from the status object's list. Otherwise, a status object will contain a dangling pointer and an attempt to access by the status object will lead to a crash.</p>
<p>The method <a class="el" href="classcadex_1_1_base___progress_status_1_1_observer.html#a9ee2b325dea4215a3c1d274d12d77730" title="A callback called when the progress status has changed its value. ">Base_ProgressStatus::Observer::ChangedValue()</a> of the observer will be called each time the current value of the status object has been incremented greater than by a threashold and if the time since the last update has exceeded the threshold. Thresholds are specified as the Register() method parameters. Settings thresholds to zero will send notifications with every update. Upon destruction of the status object the observer will be notified via <a class="el" href="classcadex_1_1_base___progress_status_1_1_observer.html#ac61f35a5b807108d1a416e0bf8f9664d" title="A callback called when the progress status object is being destructed. ">Base_ProgressStatus::Observer::Completed()</a>.</p>
<p>The calls to notification methods are blocking, i.e. the execution of the algorithm will not continue until the method returns. Therefore caution must be applied to not introduce noticeable overhead and/or to balance the frequency of notifications by setting higher thresholds when registering an observer:</p>
<div class="fragment"><div class="line">MyObserver anObserver (...);</div><div class="line">Base_ProgressStatus aStatus;</div><div class="line">aStatus.Register (anObserver, 1., 200U); <span class="comment">//will be called for every 1% and 200ms update</span></div></div><!-- fragment --><h1><a class="anchor" id="sdk_progress_scopes"></a>
Scopes</h1>
<p>For multi-stage algorithms you can define a contribution of each stage into the entire range of the progress status object. For example, importing a file consists of two stages - parsing a file contents and conversion of the file representation in memory into respective data model. Definition of each portion is done via <a class="el" href="classcadex_1_1_base___progress_scope.html" title="Represents a node in a hierarchy of progress scopes. ">Base_ProgressScope</a> object:</p>
<div class="fragment"><div class="line">Base_ProgressStatus aStatus;</div><div class="line">Base_ProgressScope aTopScope (aStatus); <span class="comment">//take entire range (100%)</span></div><div class="line">{</div><div class="line">    Base_ProgressScope aReaderScope (aTopScope, 40); <span class="comment">// 40% of aTopScope</span></div><div class="line">    aReader.ProgressStatus() = aStatus; <span class="comment">// Connect progress status object</span></div><div class="line">    {</div><div class="line">        Base_ProgressScope aSubScope (aReaderScope, 25); <span class="comment">// 25% of ReaderScope (10% of TopScope)</span></div><div class="line">        anIsOK = aReader.ReadFile (theFileName);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (anIsOK) {</div><div class="line">        Base_ProgressScope aSubScope (aReaderScope, 75); <span class="comment">// 75% of ReaderScope (30% of TopScope)</span></div><div class="line">        anIsOK = aReader.Transfer (aModel);</div><div class="line">    }</div><div class="line">}</div><div class="line"><span class="keywordflow">if</span> (anIsOK) {</div><div class="line">    Base_ProgressScope aMesherScope (aTopScope, -1); <span class="comment">// remaining 60% of TopScope</span></div><div class="line">    aMesher.ProgressStatus() = aStatus; <span class="comment">// Connect progress status object</span></div><div class="line">    aMesher.Compute (aModel);</div><div class="line">}</div></div><!-- fragment --><p>Define an average contribution (weight) of each scope based on some representative workloads.</p>
<p>A scope has a range [0, 100] by default. You can redefine it to an arbitrary range [<em>a</em>, <em>b</em>] with the help of <a class="el" href="classcadex_1_1_base___progress_scope.html#a5a571d9c0c369f2d47d55a866e6209ae" title="Set the scope range. ">Base_ProgressScope::SetRange()</a>. This can be convenient when reporting progress of a loop with a fixed number of iterations. For example:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> n = ...;</div><div class="line">Base_ProgressScope aScope (aStatus);</div><div class="line">aScope.SetRange (0, n);</div><div class="line"><span class="keywordflow">for</span> (i = 0; i &lt; n; ++i) {</div><div class="line">    Base_ProgressScope aSubScope (aScope, 1); <span class="comment">//takes 1/n-th of aScope</span></div><div class="line">    <span class="comment">//compute i-th iteration</span></div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --><p>In each thread there can be only one current scope. A new scope created in that thread will be implicitly or explicitly connected to its parent. Therefore sibling scopes must be explicitly destroyed before opening a following sibling scope, as shown in the example above.</p>
<h1><a class="anchor" id="sdk_progress_chain"></a>
Algorithms chain</h1>
<p>If several algorithms which support progress status need to represent a common range they should be chained to share the same <a class="el" href="classcadex_1_1_base___progress_status.html" title="Provides progress status and notification mechanism. ">Base_ProgressStatus</a>. To do so, just assign one shared status object to all the algorithms before their execution starts:</p>
<div class="fragment"><div class="line">Base_ProgressStatus aStatus;</div><div class="line">aStatus.Register (anObserver);</div><div class="line"></div><div class="line">ACIS_Reader aReader;</div><div class="line">aReader.ProgressStatus() = aStatus;</div><div class="line"></div><div class="line">ModelAlgo_BRepMesher aMesher;</div><div class="line">aMesher.ProgressStatus() = aStatus;</div></div><!-- fragment --><h1><a class="anchor" id="sdk_progress_user_algorithms"></a>
Using progress status in user-defined algorithms</h1>
<p>The progress status object can be used in user-defined algorithms via sharing the same object instance and using <a class="el" href="classcadex_1_1_base___progress_scope.html" title="Represents a node in a hierarchy of progress scopes. ">Base_ProgressScope</a> instances. The scopes can be nested and have own ranges for more convenient progress update. For example:</p>
<div class="fragment"><div class="line">{</div><div class="line">    Base_ProgressScope aScope (aStatus, 25); <span class="comment">// 25%</span></div><div class="line">    aMesher.Compute (aModel);</div><div class="line">}</div><div class="line">{</div><div class="line">    Base_ProgressScope aScope (aStatus); <span class="comment">// the remaining range</span></div><div class="line">    <span class="keywordtype">size_t</span> n = ...; <span class="comment">// compute number of indexed face sets</span></div><div class="line">    aScope.SetRange (0, n);</div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div><div class="line">        Base_ProgressScope aSubScope (aScope, 1); <span class="comment">//takes 1 step in parent scope</span></div><div class="line">        ModelData_IndexedFaceSet aFaceSet = ...;</div><div class="line">        MyAlgo.Process (aFaceSet);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="sdk_progress_user_multithreading"></a>
Multi-threading considerations</h1>
<p>In a multi-threaded application, by default, the observer will only get notification in a thread in which it was created. This is to minimize a risk of potential data race if the user-defined subclass is not thread-safe. If the subclass is thread-safe and can accept notifications from any thread in which the progress status object can be updated then <a class="el" href="classcadex_1_1_base___progress_status_1_1_observer.html#abf9a13f860ecb7a79ad0f4a50b61bdad" title="Enables sending notifications from any thread. ">Base_ProgressStatus::Observer::SetAllNotifyingThreads()</a> can be called to allow all threads notify the observer. Refer to the <a class="el" href="sdk_progress_bar_example_page.html">Progress Bar Example</a> which uses this feature.</p>
<h1><a class="anchor" id="sdk_progress_cancelation"></a>
Cancellation support</h1>
<p>To check if the operation has been canceled use <a class="el" href="classcadex_1_1_base___progress_status.html#a588ad457511b58704057aea145bc6a5b" title="Returns true if the operation has been canceled. ">Base_ProgressStatus::WasCanceled()</a>.</p>
<p>The operation can be canceled using two approaches: </p><ul>
<li>by an explicit call to <a class="el" href="classcadex_1_1_base___progress_status.html#a728464afbfe7d776db928e9fa6d41cc8" title="Sets the flag that the operation has been canceled. ">Base_ProgressStatus::Cancel()</a>. </li>
<li>by registering a user-defined object of the subsclass of <a class="el" href="classcadex_1_1_base___progress_status_1_1_cancellation_checker.html" title="Base abstract class for cancelation checker registered in Base_ProgressStatus. ">Base_ProgressStatus::CancellationChecker</a>, which must redefine an operator(). This callback will be called by every call to <a class="el" href="classcadex_1_1_base___progress_status.html#a588ad457511b58704057aea145bc6a5b" title="Returns true if the operation has been canceled. ">Base_ProgressStatus::WasCanceled()</a>.</li>
</ul>
<p>CAD Exchanger algorithms that support progress status regularly check if the operation has been canceled and return faster if so. The user-defined algorithm can use the following patterns to regularly check if the operation has been canceled:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (!aStatus.WasCanceled()) {</div><div class="line">    Base_ProgressScope aScope (aStatus, 50);</div><div class="line">    aMesher.Compute (aModel);</div><div class="line">}</div></div><!-- fragment --><p>or:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n &amp;&amp; !aStatus.WasCanceled(); ++i) {</div><div class="line">    aSubScope (aStatus, 1);</div><div class="line">    ModelData_Part aPart = ...;</div><div class="line">    MyAlgo.Process (aPart);</div><div class="line">}</div></div><!-- fragment --><p>Once the operation has been canceled the registered observers will be notified via calling <a class="el" href="classcadex_1_1_base___progress_status_1_1_observer.html#a33124b1c1ee42c4ac84ed051978cdaf8" title="A callback called when the progress status object was set to the canceled state. ">Base_ProgressStatus::Observer::Canceled()</a>.</p>
<p>Refer to the <a class="el" href="sdk_progress_bar_qt_example_page.html">Progress Bar with Qt Example</a> for an example that demonstrates operation cancelation. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
</div>
<div id="nav-path" class="navpath">
  <ul>
    <li class="footer">
      <a href="https://cadexchanger.com/custom-development" style="background: #226daa; color:#fff; padding: 6px; text-decoration: none; border-radius: 5px;">Custom Development</a>
      <a href="https://cadexchanger.com/products/gui" style="margin:5px;">GUI</a>
      <a href="https://cadexchanger.com/products/sdk" style="margin:5px;">SDK</a>
      <a href="https://cadexchanger.com/products/cli" style="margin:5px;">CLI</a>
      <a href="https://cadexchanger.com/products/web-toolkit" style="margin:5px;">Web Toolkit</a>
      <a href="https://cadexchanger.com/products/cloud" style="margin:5px;">Cloud</a>
      <a href="https://cadexchanger.com/products/cloud-api" style="margin:5px;">Cloud API</a>
      <a href="https://cadexchanger.com/iges" style="margin:5px; color: #838383;">IGES</a>
      <a href="https://cadexchanger.com/step" style="margin:5px; color: #838383;">STEP</a>
      <a href="https://cadexchanger.com/parasolid" style="margin:5px; color: #838383;">Parasolid</a>
      <a href="https://cadexchanger.com/acis" style="margin:5px; color: #838383;">ACIS</a>
      <a href="https://cadexchanger.com/jt" style="margin:5px; color: #838383;">JT</a>
      <a href="https://cadexchanger.com/stl" style="margin:5px; color: #838383;">STL</a>
      <a href="https://cadexchanger.com/obj" style="margin:5px; color: #838383;">OBJ</a>
      <a href="https://cadexchanger.com/solidworks" style="margin:5px; color: #838383;">SolidWorks</a>
      <a href="https://cadexchanger.com/creo" style="margin:5px; color: #838383;">Creo</a>
      <a href="https://cadexchanger.com/nx" style="margin:5px; color: #838383;">NX</a>
      <a href="https://cadexchanger.com/catia" style="margin:5px; color: #838383;">CATIA</a>
      <a href="https://cadexchanger.com/ifc" style="margin:5px; color: #838383;">IFC</a>
      <a href="https://cadexchanger.com/rhino" style="margin:5px; color: #838383;">Rhino</a>
      <a href="https://cadexchanger.com/vrml" style="margin:5px; color: #838383;">VRML</a>
      <a href="https://cadexchanger.com/fbx" style="margin:5px; color: #838383;">FBX</a>
      <a href="https://cadexchanger.com/gltf" style="margin:5px; color: #838383;">GLTF</a>
      <a href="https://cadexchanger.com/dxf" style="margin:5px; color: #838383;">DXF</a>
      <a href="https://cadexchanger.com/dwg" style="margin:5px; color: #838383;">DWG</a>
      <a href="https://cadexchanger.com/collada" style="margin:5px; color: #838383;">Collada</a>
      <a href="https://cadexchanger.com/3ds" style="margin:5px; color: #838383;">3DS</a>
      <a href="https://cadexchanger.com/x3d" style="margin:5px; color: #838383;">X3D</a>
      <a href="https://cadexchanger.com/3mf" style="margin:5px; color: #838383;">3MF</a>
      <a href="https://cadexchanger.com/u3d" style="margin:5px; color: #838383;">U3D</a>
      <a href="https://cadexchanger.com/3dpdf" style="margin:5px; color: #838383;">3D PDF</a>
      <a href="https://cadexchanger.com/prc" style="margin:5px; color: #838383;">PRC</a>
      <a href="https://cadexchanger.com/brep" style="margin:5px; color: #838383;">BRep</a>
      <a href="https://cadexchanger.com/usd" style="margin:5px; color: #838383;">USD</a>
      <a href="https://cadexchanger.com/" style="margin:5px; color: #838383;">cadexchanger.com</a>
    </li>
  </ul>
</div>
</body>
</html>
