<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CAD Exchanger SDK: Mesh Generation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link rel="icon" type="image/png" sizes="16x16" href="https://cloud.cadexchanger.com/assets/images/icon16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cloud.cadexchanger.com/assets/images/icon32.png">
<link rel="icon" type="image/png" sizes="96x96" href="https://cloud.cadexchanger.com/assets/images/icon96.png">
<link href="https://fonts.googleapis.com/css?family=Nunito:300" rel="stylesheet">
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="cadex_doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<a id="logo" href="https://cadexchanger.com/products/sdk" style="height:48px">
  <img id="projectlogo" alt="Logo" src="logo-36.png"/>
  <span id="projectname" style="padding-left:0.5em;">CAD Exchanger SDK</span>
</a>
</div>
<div class="body-content">
<div class="collapsible">
  <a id="show-menu-button" href="#">Hide menu</a>
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('sdk_usage_meshing.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Mesh Generation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#sdk_usage_meshing_overview">Overview</a></li>
<li class="level1"><a href="#sdk_meshing">The B-Rep mesher</a></li>
<li class="level1"><a href="#sdk_meshing_vismesh">Visualization mesher</a><ul><li class="level2"><a href="#sdk_meshing_parameters">Visualization mesh granularity</a></li>
<li class="level2"><a href="#sdk_meshing_uvcoordinates">UV coordinates retrieval</a></li>
<li class="level2"><a href="#sdk_meshing_performance">Visualization mesher performance</a></li>
</ul>
</li>
<li class="level1"><a href="#sdk_meshing_compmesh">Computational meshers</a></li>
<li class="level1"><a href="#sdk_meshing_workflow">Meshing workflow</a><ul><li class="level2"><a href="#sdk_meshing_workflow_merge">Stitching triangle sets</a></li>
</ul>
</li>
<li class="level1"><a href="#sdk_meshing_progress">Progress status support</a></li>
<li class="level1"><a href="#sdk_meshing_examples">Examples</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="sdk_usage_meshing_overview"></a>
Overview</h1>
<p>CAD Exchanger SDK can be used to generate meshes from <a class="el" href="classcadex_1_1_model_data___b_rep_representation.html">B-Rep representations</a>, either retrieved from imported files (e.g. from IGES, STEP, ACIS, Parasolid) or from <a class="el" href="sdk_usage_modeling_brep.html">created</a> directly inside a user's application.</p>
<p>CAD Exchanger supports the so called visualization mesher as well as computational meshers. The former generates meshes that can be primarily used for visualization and simple computing purposes (e.g. bounding boxes, approximated surface area computing, collision detection, etc). The latter generate high quality meshes that can be used in various FEA (Finite-Element Analysis) computations.</p>
<p>The following picture shows three different meshes generated from the same B-Rep model (impeller): </p><table class="doxtable">
<tr>
<td><div class="image">
<img src="mesh_sixblade_visual.png" alt="mesh_sixblade_visual.png"/>
<div class="caption">
Visual mesh</div></div>
 </td><td><div class="image">
<img src="mesh_sixblade_mefisto.png" alt="mesh_sixblade_mefisto.png"/>
<div class="caption">
Mefisto-generated mesh</div></div>
 </td><td><div class="image">
<img src="mesh_sixblade_netgen.png" alt="mesh_sixblade_netgen.png"/>
<div class="caption">
Netgen-generated mesh</div></div>
  </td></tr>
</table>
<p>CAD Exchanger can also generate 3D (volumic) meshes. However they can only be saved into specific target mesh formats, and not inside CAD Exchanger's data model.</p>
<p>CAD Exchanger itself intensively uses visualization mesher when creating <a class="el" href="classcadex_1_1_model_data___poly_representation.html">polygonal representations</a> from B-Rep, or when exporting to mesh formats (such as STL, VRML or X3D).</p>
<h1><a class="anchor" id="sdk_meshing"></a>
The B-Rep mesher</h1>
<p><a class="el" href="classcadex_1_1_model_algo___b_rep_mesher.html" title="Computes a polygonal representation from a B-Rep one. ">ModelAlgo_BRepMesher</a> which encapsulates meshing algorithms can generate meshes starting at different levels in the 3D model: </p><ul>
<li>for entire 3D model - for all parts, which have B-Rep representation and do not have polygonal representation; </li>
<li>starting at any (sub-)assembly, instance or part - for all parts underneath the start element, which have B-Rep representation and do not have polygonal representation; </li>
<li>for a B-Rep represenation - for all solid and sheet bodies inside the B-Rep representation; </li>
<li>for a particular solid or sheet <a class="el" href="classcadex_1_1_model_data___body.html#sdk_data_model_brep_bodytypes">body</a>.</li>
</ul>
<p>The following examples demonstrates applying the visualization mesher at different levels.</p>
<p><b>Example1:</b> generation of meshes for all parts in the models which do not have polygonal representations:</p>
<div class="fragment"><div class="line">ModelData_Model aModel = ...;</div><div class="line">ModelAlgo_BRepMesher aMesher (ModelAlgo_BRepMesherParameters::Fine);</div><div class="line">aMesher.Compute (aModel);</div></div><!-- fragment --><p><b>Example2:</b> generation of a mesh for a particular B-Rep body:</p>
<div class="fragment"><div class="line">ModelData_Body aBody = ...;</div><div class="line">ModelData_PolyShapeList aList = aMesher.Compute (aBody);</div><div class="line"><span class="keywordflow">if</span> (aList) {</div><div class="line">    <span class="keywordflow">for</span> (ModelData_PolyShapeList::SizeType i = 0; i &lt; aList.Size(); ++i) {</div><div class="line">        <span class="keyword">const</span> ModelData_PolyVertexSet&amp; aPVSet = aList[i];</div><div class="line">        <span class="keywordflow">if</span> (aPVS.TypeId() == ModelData_IndexedTriangleSet::GetTypeId()) {</div><div class="line">            DumpTriangleSet (static_cast&lt;const ModelData_IndexedTriangleSet&amp;&gt; (aPVS), theTrsf);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="sdk_meshing_vismesh"></a>
Visualization mesher</h1>
<p>Visualization mesh has a form of triangulation and is primarily fitted for visualization and other purposes (e.g. calculation of a bounding box of the model). CAD Exchanger GUI application uses visualization mesh to display shaded presentations of the model in 3D views.</p>
<p>Computed triangulation is stored internally inside the B-Rep faces (<a class="el" href="classcadex_1_1_model_data___face.html" title="Defines a topological face. ">ModelData_Face</a>).</p>
<p>Visualization mesh can often be unusable for various finite element analysis algorithms which are sensitive to triangles shape. For example, the mesher can often produce significantly elongate triangles as shown on the following image:</p>
<div class="image">
<img src="mesh_cylinder-256.png" alt="mesh_cylinder-256.png"/>
<div class="caption">
Triangulated cylindrical face</div></div>
<h2><a class="anchor" id="sdk_meshing_parameters"></a>
Visualization mesh granularity</h2>
<p>Number and size of triangles in visualization mesh depend on the requested precision defined either via <a class="el" href="classcadex_1_1_model_algo___b_rep_mesher_parameters.html#aa699176cf4b8eab91b16b9b895d1304c" title="Sets mesh granularity policy. ">ModelAlgo_BRepMesherParameters::SetGranularity()</a> using the <a class="el" href="classcadex_1_1_model_algo___b_rep_mesher_parameters.html#a2260130f59c9cd2c23ec9a3140faf564" title="Defines target accuracy of the mesh to be generated. ">ModelAlgo_BRepMesherParameters::Granularity</a> enumeration value or via direct setting (<a class="el" href="classcadex_1_1_model_algo___b_rep_mesher_parameters.html#aa8a517bed610cabc7685a7a3c9f0c139" title="Sets chordal deflection. ">ModelAlgo_BRepMesherParameters::SetChordalDeflection()</a>).</p>
<p>The following images demonstrate coarser and finer meshes built for the same B-Rep shape:</p>
<table  border="0" align="center">
<tr>
<td><div class="image">
<img src="mesh_coarse-256.png" alt="mesh_coarse-256.png"/>
<div class="caption">
Mesh built with coarser precision</div></div>
 </td><td><div class="image">
<img src="mesh_fine-256.png" alt="mesh_fine-256.png"/>
<div class="caption">
Mesh built with finer precision</div></div>
  </td></tr>
</table>
<p>The finer the requested precision the longer it takes to produce the mesh and the greater memory footprint it will have. On 32 bit systems, requesting too fine precision for medium and complex models may result in a memory footprint exceeding available virtual memory and hence in application's forced termination. In most cases, default precision value should be sufficient.</p>
<h2><a class="anchor" id="sdk_meshing_uvcoordinates"></a>
UV coordinates retrieval</h2>
<p>If the flag <a class="el" href="classcadex_1_1_model_algo___b_rep_mesher_parameters.html#a9886f83c73a978fa46b0067cf727064e">GetUVCoordinates()</a> is set to true then the visualization mesher will retrieve UV coordinates of mesh nodes in parametric domain of each surface and store them in resulting <a class="el" href="classcadex_1_1_model_data___indexed_triangle_set.html" title="Defines a polygonal shape consisting of triangles. ">ModelData_IndexedTriangleSet</a>. This only applies if the flag <a class="el" href="classcadex_1_1_model_algo___b_rep_mesher_parameters.html#a5a29befd20bf707f3f023cc9a07918c0">MergeFaceSets()</a> is set to false, i.e. no <a class="el" href="sdk_usage_meshing.html#sdk_meshing_workflow_merge">stitching of triangle sets</a> is performed.</p>
<p>For faces on closed periodic surfaces (e.g. cylindrical, conical, surfaces of revolution, etc) there will be two mesh nodes along the surface seam for each point on the seam-edge:</p>
<table  border="0" align="center">
<tr>
<td><div class="image">
<img src="mesh_uv_seam_brep.png" alt="mesh_uv_seam_brep.png"/>
<div class="caption">
B-Rep face on a surface of revolution</div></div>
 </td><td><div class="image">
<img src="mesh_uv_seam_poly.png" alt="mesh_uv_seam_poly.png"/>
<div class="caption">
Resulting mesh</div></div>
  </td></tr>
</table>
<p>For faces on surfaces with singularities (e.g. spherical, conical, B-Splines, etc) there will be multiple mesh UV-nodes corresponding to a point of singularity:</p>
<table  border="0" align="center">
<tr>
<td><div class="image">
<img src="mesh_uv_singularity_brep.png" alt="mesh_uv_singularity_brep.png"/>
<div class="caption">
B-Rep face on a spherical surface</div></div>
 </td><td><div class="image">
<img src="mesh_uv_singularity_poly.png" alt="mesh_uv_singularity_poly.png"/>
<div class="caption">
Resulting mesh</div></div>
  </td></tr>
</table>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="classcadex_1_1_model_data___indexed_triangle_set.html#a83793ba5757ee032d22c3536786da34b" title="Returns true if the triangle set has UV coordinates associated with vertices. ">ModelData_IndexedTriangleSet::HasUVCoordinates()</a>, <a class="el" href="classcadex_1_1_model_data___indexed_triangle_set.html#abefed3ade85484246dcdcdca61621c42" title="Returns a UV coordinate associated with a vertex. ">ModelData_IndexedTriangleSet::UVCoordinate()</a>.</dd></dl>
<h2><a class="anchor" id="sdk_meshing_performance"></a>
Visualization mesher performance</h2>
<p>Mesh generation is a heavy-computational task and depending on model complexity and requested precision may take significant time. If the parameter <a class="el" href="classcadex_1_1_base___settings.html#ae1ffddfb8806387fbb3b26581dcd9e72a9292af75feb9369ff1e484517831904c">Base_Settings::Common_ConcurrentMode</a> is true, then on multi-core processor systems, the algorithm will try to run in parallel. However scalability will depend on model structure and unbalanced workloads are possible.</p>
<h1><a class="anchor" id="sdk_meshing_compmesh"></a>
Computational meshers</h1>
<p>Computational mesh can be used for finite element analysis and other computations.</p>
<p>The following image shows a computational mesh built on a cylindrical surface similar to the one above: </p><div class="image">
<img src="mesh_cylinder_comp-256.png" alt="mesh_cylinder_comp-256.png"/>
<div class="caption">
Computational mesh on a cylindrical face</div></div>
<p> To generate a computational mesh instead of visualization the computational mesher algorithm should be specified in the parameters objects set in the <a class="el" href="classcadex_1_1_model_algo___b_rep_mesher.html" title="Computes a polygonal representation from a B-Rep one. ">ModelAlgo_BRepMesher</a>.</p>
<p>The example below demonstrates creation of a computational mesh with the help of Netgen mesher:</p>
<div class="fragment"><div class="line">ModelAlgo_BRepMesherParameters aParam;</div><div class="line">MeshAlgo_NetgenFactory aMF;</div><div class="line">MeshAlgo_NetgenFactory::Parameters aP;</div><div class="line">aP.SetGranularity (MeshAlgo_NetgenFactory::Parameters::Fine);</div><div class="line">aMF.SetParameters (aP);</div><div class="line">aParam.ComputationalMeshAlgo() = aMF;</div><div class="line"></div><div class="line">ModelAlgo_BRepMesher aMesher (aParam);</div><div class="line">ModelData_BRepRepresentation aBRep = ...;</div><div class="line">ModelData_PolyRepresentation aPoly = aMesher.Compute (aBRep);</div></div><!-- fragment --><p>If the B-Rep shape does not have an internal triangulation, then Compute() will first invoke a visualization mesher prior to invoking the computational mesher.</p>
<p>For details on computational meshers refer to <a class="el" href="sdk_meshing_advalgos.html">Computational meshers</a>.</p>
<h1><a class="anchor" id="sdk_meshing_workflow"></a>
Meshing workflow</h1>
<p>Any mesher follows the same bottom-up workflow: </p><ul>
<li>B-Rep vertices are mapped into mesh nodes; </li>
<li>B-Rep edges are discretized and internal points are mapped to mesh nodes; </li>
<li>B-Rep faces are tessellated and internal points are mapped to mesh nodes.</li>
</ul>
<p>This allows to have water-tight meshes along the shared B-Rep edges and ensures that any B-Rep vertex is mapped to a mesh node. The policy of edge discretization and face tessellation is determined by each mesher and its parameters.</p>
<p>Each B-Rep face initially maps to one triangle set (<a class="el" href="classcadex_1_1_model_data___indexed_triangle_set.html" title="Defines a polygonal shape consisting of triangles. ">ModelData_IndexedTriangleSet</a>). Triangle sets can be then stitched (merged) together as explained below.</p>
<h2><a class="anchor" id="sdk_meshing_workflow_merge"></a>
Stitching triangle sets</h2>
<p>If <a class="el" href="classcadex_1_1_model_algo___b_rep_mesher_parameters.html#a5a29befd20bf707f3f023cc9a07918c0" title="Returns true if the triangle sets from B-Rep faces should be merged. ">ModelAlgo_BRepMesherParameters::MergeFaceSets()</a> is set to true (by default), then triangle sets (<a class="el" href="classcadex_1_1_model_data___indexed_triangle_set.html" title="Defines a polygonal shape consisting of triangles. ">ModelData_IndexedTriangleSet</a>) resulting from B-Rep faces of the same body will be merged into one <a class="el" href="classcadex_1_1_model_data___indexed_triangle_set.html" title="Defines a polygonal shape consisting of triangles. ">ModelData_IndexedTriangleSet</a>. This allows to get a single triangle set for entire solid and thus to have a water-tight triangulation. Otherwise there will be as many <a class="el" href="classcadex_1_1_model_data___indexed_triangle_set.html" title="Defines a polygonal shape consisting of triangles. ">ModelData_IndexedTriangleSet</a>'s as there are faces in the original B-Rep body.</p>
<p>For sheet bodies stitching will be done inside each shell and standalone face of the body.</p>
<p>During meshing triangle sets will inherit appearance settings associated with the original B-Rep faces (see ModelData_BRepRepresentation::Appearance()). When merging triangle sets with different appearance settings will be put into different groups. Thus, if a solid box had 3 different colors associated with its child faces then the resulting polygonal representation will have at least 3 triangle sets, even if <a class="el" href="classcadex_1_1_model_algo___b_rep_mesher_parameters.html#a5a29befd20bf707f3f023cc9a07918c0" title="Returns true if the triangle sets from B-Rep faces should be merged. ">ModelAlgo_BRepMesherParameters::MergeFaceSets()</a> is set to true. To ensure merging into a single triangle set either do not associate colors to faces or to invoke <a class="el" href="classcadex_1_1_model_algo___b_rep_mesher.html#a0a09ed0e1b46333025f51e38f74fef6b" title="Computes polygonal representations for all parts in the model. ">ModelAlgo_BRepMesher::Compute()</a> for <a class="el" href="classcadex_1_1_model_data___body.html" title="Defines a root topological shape that can be owned by B-Rep representation. ">ModelData_Body</a> (which does not store appearances).</p>
<h1><a class="anchor" id="sdk_meshing_progress"></a>
Progress status support</h1>
<p>The meshing algorithms support <a class="el" href="sdk_progress_page.html">progress status update</a>, including cancellation. The example below demonstrates how to add observers to a progress status object:</p>
<div class="fragment"><div class="line">ModelData_Model aModel;</div><div class="line"></div><div class="line"><span class="comment">//MyObserver is a subclass of Base_ProgressStatus::Observer</span></div><div class="line">MyObserver anObserver (...); <span class="comment">//must have greater lifetime than progress status</span></div><div class="line"></div><div class="line">Base_ProgressStatus aStatus;</div><div class="line">aStatus.Register (anObserver);</div><div class="line">{</div><div class="line">    ModelAlgo_BRepMesher aMesher;</div><div class="line">    aMesher.ProgressStatus() = aStatus;</div><div class="line">    {</div><div class="line">        Base_ProgressScope aScope (aStatus); <span class="comment">//80%</span></div><div class="line">        aMesher.Compute (aModel);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>For details refer to <a class="el" href="sdk_progress_page.html">Progress Status Support</a> and <a class="el" href="sdk_progress_bar_example_page.html">Progress Bar Example</a>.</p>
<h1><a class="anchor" id="sdk_meshing_examples"></a>
Examples</h1>
<p>Refer to <a class="el" href="sdk_all_examples.html#sdk_meshing_examples_section">Meshing</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
</div>
<div id="nav-path" class="navpath">
  <ul>
    <li class="footer">
      <a href="https://cadexchanger.com/custom-development" style="background: #226daa; color:#fff; padding: 6px; text-decoration: none; border-radius: 5px;">Custom Development</a>
      <a href="https://cadexchanger.com/products/gui" style="margin:5px;">GUI</a>
      <a href="https://cadexchanger.com/products/sdk" style="margin:5px;">SDK</a>
      <a href="https://cadexchanger.com/products/cli" style="margin:5px;">CLI</a>
      <a href="https://cadexchanger.com/products/web-toolkit" style="margin:5px;">Web Toolkit</a>
      <a href="https://cadexchanger.com/products/cloud" style="margin:5px;">Cloud</a>
      <a href="https://cadexchanger.com/products/cloud-api" style="margin:5px;">Cloud API</a>
      <a href="https://cadexchanger.com/iges" style="margin:5px; color: #838383;">IGES</a>
      <a href="https://cadexchanger.com/step" style="margin:5px; color: #838383;">STEP</a>
      <a href="https://cadexchanger.com/parasolid" style="margin:5px; color: #838383;">Parasolid</a>
      <a href="https://cadexchanger.com/acis" style="margin:5px; color: #838383;">ACIS</a>
      <a href="https://cadexchanger.com/jt" style="margin:5px; color: #838383;">JT</a>
      <a href="https://cadexchanger.com/stl" style="margin:5px; color: #838383;">STL</a>
      <a href="https://cadexchanger.com/obj" style="margin:5px; color: #838383;">OBJ</a>
      <a href="https://cadexchanger.com/solidworks" style="margin:5px; color: #838383;">SolidWorks</a>
      <a href="https://cadexchanger.com/creo" style="margin:5px; color: #838383;">Creo</a>
      <a href="https://cadexchanger.com/nx" style="margin:5px; color: #838383;">NX</a>
      <a href="https://cadexchanger.com/catia" style="margin:5px; color: #838383;">CATIA</a>
      <a href="https://cadexchanger.com/ifc" style="margin:5px; color: #838383;">IFC</a>
      <a href="https://cadexchanger.com/rhino" style="margin:5px; color: #838383;">Rhino</a>
      <a href="https://cadexchanger.com/vrml" style="margin:5px; color: #838383;">VRML</a>
      <a href="https://cadexchanger.com/fbx" style="margin:5px; color: #838383;">FBX</a>
      <a href="https://cadexchanger.com/gltf" style="margin:5px; color: #838383;">GLTF</a>
      <a href="https://cadexchanger.com/dxf" style="margin:5px; color: #838383;">DXF</a>
      <a href="https://cadexchanger.com/dwg" style="margin:5px; color: #838383;">DWG</a>
      <a href="https://cadexchanger.com/collada" style="margin:5px; color: #838383;">Collada</a>
      <a href="https://cadexchanger.com/3ds" style="margin:5px; color: #838383;">3DS</a>
      <a href="https://cadexchanger.com/x3d" style="margin:5px; color: #838383;">X3D</a>
      <a href="https://cadexchanger.com/3mf" style="margin:5px; color: #838383;">3MF</a>
      <a href="https://cadexchanger.com/u3d" style="margin:5px; color: #838383;">U3D</a>
      <a href="https://cadexchanger.com/3dpdf" style="margin:5px; color: #838383;">3D PDF</a>
      <a href="https://cadexchanger.com/prc" style="margin:5px; color: #838383;">PRC</a>
      <a href="https://cadexchanger.com/brep" style="margin:5px; color: #838383;">BRep</a>
      <a href="https://cadexchanger.com/usd" style="margin:5px; color: #838383;">USD</a>
      <a href="https://cadexchanger.com/" style="margin:5px; color: #838383;">cadexchanger.com</a>
    </li>
  </ul>
</div>
</body>
</html>
